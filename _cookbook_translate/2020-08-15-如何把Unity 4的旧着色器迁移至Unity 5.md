---
category: shader
tags: [U3D, Shader,Cookbook,中文版]
---

### 如何把Unity 4的旧着色器迁移至Unity 5
不可否认，在过去10年中图形学在电子游戏中获得了惊人的发展。每一个新游戏带来的尖端技术让我们的游戏画面更加接近现实。随着Unity引擎版本的不断迭代，它的着色器技术也自然而然的经历了相当大的变化。这也是为什第一次接触着色器的时候感到困惑的原因。在Unity5还没有推出之前，Unity自带了两种不同的着色器，分别是：**漫反射(Diffuse)**和**镜面反射(Specular)**。正如其名字所描述，它们分别用来模拟表面粗糙和表面光滑的材料。如果你现在使用的Unity5，那么你其实可以跳过这个知识点。该知识点会讲解如何在Unity5中重现这些效果。 

***

- **始前准备**

  要开始这个知识点，前提时你有个用Unity4版本作为开发引擎工作空间，并且你使用了这个版本内建的一些着色器。当你开发新游戏的时候，毫无疑问你应该改选择最新版本的Unity引擎。然而如果你的项目已经使用了旧版的Unity引擎开发，那么你在迁移着色器前应该三思。引擎背后可能又很多东西都不一样了，即使有时候内建的着色器表面看起来可以正常工作，但是你写的脚本可未必能。所以如果你要迁移整个项目空间，这个时候首先要做的事情就是备份。但是要注意噢，仅仅只是保存Assets资源和场景可不够，同时所有的.meta文件也要一并保存，因为大多数Unity的配置信息保存在元数据中。在迁移项目的过程中最稳妥的办法还是要把整个项目空间所在文件夹都复制一份。最好的是物理拷贝一份，如果是windows就在资源管理器物理复制，如果是Mac就在Finder中物理复制。【建议大家将这个项目目录用压缩工具【如winrar】打包一份】。
  
***

  

- **操作步骤**

  如果你想要迁移你的内建着色器，有两个主要选择：采用自动升级的方式或者切换至**标准着色器**

  - **着色器版本的自动升级**

    这种选择是最操作起来最简单的。Unity5可以导入使用旧版内建着色器的项目并且自动升级。你需要主义的是一旦升级完成后，那么你在Unity4中就不能再使用它们了。尽管这个过程并没有直接改变你的Assets资源，但是Unity的元数据已经被转换过了。要进行这个过程，你需要打开Unity5引擎，然后点击**文件(File)\|打开项目(Open Project)**来打开你就项目所在的文件夹。然后回有提示问你是否愿意转换；然后点击**升级(Upgrade)**执行改过程。Unity就会重新导入所有的Assets资源并且重新编译所有的游戏脚本。如果你的项目非常巨大，这个过程可能回持续几个小时。一旦转换完成，来自Unity4的内建的旧着色器会被相应的替换掉。 你可以通过查看面板验证这个转换，材质实例中从原来的**Bumped Diffuse**变为了**Legacy Shader/Bumped Diffuse**。
    
    **注意**
    
    尽管Unity4版本的漫反射，镜面反射和其他内建的着色器现在已经已弃用了，但是Unity5依然向后对它们保持兼容。它们在材质的**Legacy Shaders**路径下的下拉列表中依然可以看到。
    
  - **使用标准着色器**
  
    相比于使用旧版本的着色器，你可能想使用Unity5新的内建标准着色器替代它们。但是这么做之前，请留意新旧两个版本的着色器是基于不同的光照模型的，你的材质很可能看起来不一样。Unity4总共有8个不同的内建着色器，它被划分进了6个大类(**法线(Normal)**，**透明(Transparent)**，**透明剪切(Transparent Cutout)**，**自发光(Self-Illuminated)**和**反射(Reflective)**)。但在Unity5中，它们都被上一个知识点所讲的那些标准着色器所替代了。不幸的是，没有什么很好的办法能够将旧着色器完美的迁移只新版本的着色器。但是你可以通过下面这个表格着重理解如何通过配置标准着色器去模拟unity4的旧着色器的效果：
    
    
    <table>
        <tr>
            <th>Shader</th>
            <th>Unity 4 </th>
            <th>Unity 4 (Legacy)</th>
            <th>Unity 5</th>
      </tr>
        <tr>
            <td>Diffuse</td>
            <td>Diffuse Lambert</td>
            <td>Legacy Shader/Diffuse Lambert</td>
            <td>Standard Physically-based rendering: Metallic Workflow</td>
        </tr>
        <tr>
            <td>Specular</td>
            <td>Specular Blinn-Phong </td>
            <td>Legacy Shader/Specular Blinn-Phong</td>
            <td>Standard (Specular setup) Physically-based rendering: Specular Workflow</td>
        </tr>
        <tr>
            <td rowspan="2">Transparent</td>
            <td>Specular Blinn-Phong </td>
            <td>Legacy Shader/Transparent Vertex-Lit</td>
            <td>Standard Rendering Mode: Transparent</td>
        </tr>
         <tr>
            <td>Transparent Cutout Vertex-Lit </td>
            <td>Legacy Shader/Transparent Cutout Vertex-Lit</td>
            <td>Standard Rendering Mode: Cutout</td>
        </tr>
    </table>
    
    你可以在旧材质的**查看面板(Inspector)**上通过**着色器(Shader)**下拉菜单改变它所使用的着色器。所有你需要做的就是简单的选择适当的标准材质。如果你的旧着色器使用了贴图，颜色和发现题图，那么在新版本的标准着色器上也会自动使用。当然为了更好的接近之前旧版本着色器的光照模型，你可能需要配置标准着色器的相关参数。 下图展示的是常见的斯坦福兔(*Stanford bunny* )，它们分别使用旧版本的漫反射着色器(右)，被转换的标准着色器(左)，和把**平滑度(Smoothness)**设置成0的标准着色器(中)：
    
    <div align="center"><img src="https://linkliu.github.io/tech-landscape/assets/img/shader_book/diagram4.png"/></div>	      
  